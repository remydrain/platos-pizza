---
title: "Plato's Pizza"
author: "Remy Drain"
date: "Last updated `r Sys.Date()`"
output: 
  html_notebook:
    toc: true
---

## Process
### Load Packages
```{r install and load packages, echo=TRUE, results='hide', message=FALSE, warning=FALSE}
library(tidyverse)
library(RSQLite)
library(forcats)
library(ggplot2)
```

### Read in the datasets
```{r read in data, echo=TRUE, results='hide', message=FALSE, warning=FALSE}
dict <- read.csv(file.path(getwd(), "sales-data/data_dictionary.csv"))
order_details <- read.csv(file.path(getwd(), "sales-data/pizza_sales/order_details.csv"))
orders <- read.csv(file.path(getwd(), "sales-data/pizza_sales/orders.csv"))
pizza_types <- read.csv(file.path(getwd(), "sales-data/pizza_sales/pizza_types.csv"))
pizzas <- read.csv(file.path(getwd(), "sales-data/pizza_sales/pizzas.csv"))
```

### Explore the data
I've got my data imported, including the data dictionary that was provided. I'll use tibbles to get an idea of what the data looks like in each of the tables.
```{r}
tibble(dict)
tibble(order_details)
tibble(orders)
tibble(pizza_types)
tibble(pizzas)
```

I want to aggregate some of the data and create at least one new variable showing the day of the week, so I'm going to use the `RSQLite` package to create a virtual database that I can run SQL queries through, then save them as dataframes for plotting.

### Create a SQLite Database
```{r create database, echo=TRUE, results='hide', message=FALSE, warning=FALSE}
db <- dbConnect(RSQLite::SQLite(), dbname=":memory:")

dbWriteTable(db, "order_details", order_details)
dbWriteTable(db, "orders", orders)
dbWriteTable(db, "pizza_types", pizza_types)
dbWriteTable(db, "pizzas", pizzas)

dbListTables(db)
```

```{sql add weekdays variable, connection=db, output.var="orders_df"}
SELECT
  strftime('%w', julianday(date)) AS weekday,
  date
FROM orders
```
*ref:* <https://www.sqlite.org/lang_datefunc.html#strftm>
